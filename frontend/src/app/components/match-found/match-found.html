<div class="match-found-overlay" *ngIf="isVisible && matchData">
  <div class="match-found-modal">
    <!-- Header -->
    <div class="match-header">
      <h2>üéÆ Partida Encontrada!</h2>
    </div>

    <!-- Teams Overview -->
    <div class="teams-container">
      <!-- Blue Team (Always Left) -->
      <div class="team-section blue-team">
        <div class="team-header" [style.border-color]="getTeamColor('blue')">
          <h3 [style.color]="getTeamColor('blue')">
            {{ getTeamSideName('blue') }}
          </h3>
          <span class="team-mmr"
            >{{ getRoundedMMR(blueTeamMMR) }} MMR m√©dio</span
          >
        </div>

        <div class="players-list">
          <div
            class="player-card"
            *ngFor="let player of sortedBlueTeam"
            [class.current-player]="isCurrentPlayer(player)"
            [class.accepted-player]="hasPlayerAccepted(player)"
            [class.declined-player]="hasPlayerDeclined(player)"
            [class.timeout-player]="hasPlayerTimeout(player)"
          >
            <!-- Status de Aceita√ß√£o -->
            <div
              class="acceptance-status"
              [ngClass]="getAcceptanceStatusClass(player)"
            >
              <span class="status-icon"
                >{{ getAcceptanceStatusIcon(player) }}</span
              >
            </div>

            <div class="player-avatar">
              <ng-container *ngIf="!(isPlayerBot(player)); else botIcon">
                <img
                  *ngIf="getPlayerProfileIconUrlIfHuman(player) | async as iconUrl"
                  [src]="iconUrl"
                  alt="Avatar"
                  class="avatar-image"
                  [class.blurred]="shouldBlurPlayerInfo(player)"
                  (error)="onProfileIconError($event, player)"
                />
              </ng-container>
              <ng-template #botIcon>
                <img
                  src="/assets/images/champion-placeholder.svg"
                  alt="Bot"
                  class="avatar-image"
                  [class.blurred]="shouldBlurPlayerInfo(player)"
                  style="opacity: 0.5"
                />
              </ng-template>
            </div>
            <div class="player-info">
              <div class="player-main-info">
                <div class="name-lane-row">
                  <span
                    class="player-name"
                    [class.blurred]="shouldBlurPlayerInfo(player)"
                  >
                    {{ player.summonerName }}
                  </span>
                  <span
                    class="lane-badge"
                    [ngClass]="{
                      'badge-primary': getLaneBadgeType(player) === 'primary',
                      'badge-secondary': getLaneBadgeType(player) === 'secondary',
                      'badge-autofill': getLaneBadgeType(player) === 'autofill'
                    }"
                    *ngIf="getLaneBadgeType(player)"
                  >
                    {{ getLaneBadgeText(getLaneBadgeType(player)) }}
                  </span>
                </div>
                <div class="badge-mmr-row">
                  <span
                    class="player-mmr"
                    [class.mmr-censored]="shouldBlurPlayerInfo(player)"
                    [attr.data-mmr]="shouldBlurPlayerInfo(player) ? (player.mmr + ' MMR') : null"
                  >
                    {{ shouldBlurPlayerInfo(player) ? '*** MMR' : (player.mmr +
                    ' MMR') }}
                  </span>
                </div>
              </div>
              <div class="player-lanes">
                <span
                  class="lane assigned-lane"
                  [class.autofill]="player.isAutofill"
                >
                  {{ getAssignedLaneDisplay(player) }}
                </span>
                <span class="lane-separator">‚Ä¢</span>
                <span class="lane preferences-lane">
                  {{ getLanePreferencesDisplay(player) }}
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- VS Divider -->
      <div class="vs-divider">
        <span class="vs-text">VS</span>
      </div>

      <!-- Red Team (Always Right) -->
      <div class="team-section red-team">
        <div class="team-header" [style.border-color]="getTeamColor('red')">
          <h3 [style.color]="getTeamColor('red')">
            {{ getTeamSideName('red') }}
          </h3>
          <span class="team-mmr"
            >{{ getRoundedMMR(redTeamMMR) }} MMR m√©dio</span
          >
        </div>

        <div class="players-list">
          <div
            class="player-card"
            *ngFor="let player of sortedRedTeam"
            [class.current-player]="isCurrentPlayer(player)"
            [class.accepted-player]="hasPlayerAccepted(player)"
            [class.declined-player]="hasPlayerDeclined(player)"
            [class.timeout-player]="hasPlayerTimeout(player)"
          >
            <!-- Status de Aceita√ß√£o -->
            <div
              class="acceptance-status"
              [ngClass]="getAcceptanceStatusClass(player)"
            >
              <span class="status-icon"
                >{{ getAcceptanceStatusIcon(player) }}</span
              >
            </div>

            <div class="player-avatar">
              <ng-container *ngIf="!(isPlayerBot(player)); else botIcon">
                <img
                  *ngIf="getPlayerProfileIconUrlIfHuman(player) | async as iconUrl"
                  [src]="iconUrl"
                  alt="Avatar"
                  class="avatar-image"
                  [class.blurred]="shouldBlurPlayerInfo(player)"
                  (error)="onProfileIconError($event, player)"
                />
              </ng-container>
              <ng-template #botIcon>
                <img
                  src="/assets/images/champion-placeholder.svg"
                  alt="Bot"
                  class="avatar-image"
                  [class.blurred]="shouldBlurPlayerInfo(player)"
                  style="opacity: 0.5"
                />
              </ng-template>
            </div>
            <div class="player-info">
              <div class="player-main-info">
                <div class="name-lane-row">
                  <span
                    class="player-name"
                    [class.blurred]="shouldBlurPlayerInfo(player)"
                  >
                    {{ player.summonerName }}
                  </span>
                  <span
                    class="lane-badge"
                    [ngClass]="{
                      'badge-primary': getLaneBadgeType(player) === 'primary',
                      'badge-secondary': getLaneBadgeType(player) === 'secondary',
                      'badge-autofill': getLaneBadgeType(player) === 'autofill'
                    }"
                    *ngIf="getLaneBadgeType(player)"
                  >
                    {{ getLaneBadgeText(getLaneBadgeType(player)) }}
                  </span>
                </div>
                <div class="badge-mmr-row">
                  <span
                    class="player-mmr"
                    [class.mmr-censored]="shouldBlurPlayerInfo(player)"
                    [attr.data-mmr]="shouldBlurPlayerInfo(player) ? (player.mmr + ' MMR') : null"
                  >
                    {{ shouldBlurPlayerInfo(player) ? '*** MMR' : (player.mmr +
                    ' MMR') }}
                  </span>
                </div>
              </div>
              <div class="player-lanes">
                <span
                  class="lane assigned-lane"
                  [class.autofill]="player.isAutofill"
                >
                  {{ getAssignedLaneDisplay(player) }}
                </span>
                <span class="lane-separator">‚Ä¢</span>
                <span class="lane preferences-lane">
                  {{ getLanePreferencesDisplay(player) }}
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Accept/Decline Phase -->
    <div class="accept-phase" *ngIf="matchData.phase === 'match_found'">
      <!-- ‚úÖ NOVO LAYOUT: Balanceamento √† esquerda, Aceita√ß√£o √† direita -->
      <div class="info-row">
        <!-- Match Balance Info (esquerda) -->
        <div class="match-balance">
          <div class="balance-header">
            <h4>‚öñÔ∏è Balanceamento</h4>
          </div>

          <div class="mmr-comparison">
            <div class="team-mmr-display">
              <span class="team-label blue">Azul</span>
              <span class="mmr-value">{{ getBlueTeamMMR() }}</span>
            </div>

            <span class="vs-separator">VS</span>

            <div class="team-mmr-display">
              <span class="team-label red">Vermelho</span>
              <span class="mmr-value">{{ getRedTeamMMR() }}</span>
            </div>
          </div>

          <div class="balance-info">
            <span class="balance-label">Dif:</span>
            <span
              class="balance-value"
              [class.excellent]="isExcellentBalance()"
              [class.good]="isGoodBalance()"
              [class.fair]="isFairBalance()"
            >
              {{ getMMRDifference() }}
            </span>
          </div>
        </div>

        <!-- Progresso de Aceita√ß√£o (direita) -->
        <div class="acceptance-progress">
          <div class="progress-header">
            <span class="progress-text">
              {{ acceptedPlayersCount }}/{{ totalPlayersCount }} aceitaram
            </span>
            <span class="progress-percentage">{{ acceptanceProgress }}%</span>
          </div>
          <div class="progress-bar">
            <div
              class="progress-fill"
              [style.width.%]="acceptanceProgress"
              [class.complete]="haveAllPlayersAccepted"
            ></div>
          </div>
        </div>
      </div>

      <div class="countdown-timer">
        <div class="timer-circle" [class.urgent]="isTimerUrgent">
          <span class="time-left">{{ acceptTimeLeft }}</span>
        </div>
        <div class="timer-message">
          <p>{{ acceptTimeLeft }}s para aceitar</p>
        </div>
      </div>

      <div class="action-buttons">
        <button class="accept-btn" (click)="onAcceptMatch()">
          <span class="btn-icon">‚úì</span>
          Aceitar
        </button>
        <button class="decline-btn" (click)="onDeclineMatch()">
          <span class="btn-icon">‚úï</span>
          Recusar
        </button>
      </div>
    </div>
  </div>
</div>
