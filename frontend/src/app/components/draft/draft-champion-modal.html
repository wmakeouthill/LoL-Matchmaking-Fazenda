<div
  class="champion-modal-overlay"
  *ngIf="isVisible && session && (isEditingMode || (session.phase !== 'completed' && session.currentAction < session.phases.length))"
  (click)="closeModal()"
  (keydown.escape)="closeModal()"
>
  <div
    class="champion-modal"
    (click)="$event.stopPropagation()"
    (keydown)="$event.stopPropagation()"
  >
    <!-- Header do Modal -->
    <div class="modal-header" [style.border-color]="getCurrentTeamColor()">
      <div class="modal-title">
        <span class="modal-icon">{{ getCurrentActionIcon() }}</span>
        <div class="modal-title-text">
          <h2>{{ getCurrentActionText() }}</h2>
          <p class="modal-subtitle">
            {{ getCurrentPlayerNameForModal() }} - {{
            getCurrentPlayerTeamForModal() }}
            <span class="you-indicator" *ngIf="isCurrentPlayerForModal()"
              >(Voc√™)</span
            >
          </p>
        </div>
      </div>

      <!-- Timer do Modal -->
      <div class="modal-timer-section">
        <div class="modal-timer" [class.warning]="timeRemaining <= 10">
          ‚è±Ô∏è {{ timeRemaining }}s
        </div>
      </div>

      <button class="modal-close-btn" (click)="closeModal()">‚úï</button>
    </div>

    <!-- Conte√∫do do Modal -->
    <div class="modal-content">
      <!-- Filtros -->
      <div class="modal-filters">
        <!-- Role Filter -->
        <div class="modal-role-filter">
          <div class="filter-label">Filtrar por Lane:</div>
          <div class="role-buttons">
            <button
              class="role-btn"
              [class.active]="selectedRole === 'all'"
              (click)="selectRoleInModal('all')"
            >
              Todos ({{ champions.length }})
            </button>
            <button
              class="role-btn"
              [class.active]="selectedRole === 'top'"
              (click)="selectRoleInModal('top')"
            >
              üõ°Ô∏è Top ({{ championsByRole.top.length || 0 }})
            </button>
            <button
              class="role-btn"
              [class.active]="selectedRole === 'jungle'"
              (click)="selectRoleInModal('jungle')"
            >
              üå≤ Jungle ({{ championsByRole.jungle.length || 0 }})
            </button>
            <button
              class="role-btn"
              [class.active]="selectedRole === 'mid'"
              (click)="selectRoleInModal('mid')"
            >
              ‚ö° Mid ({{ championsByRole.mid.length || 0 }})
            </button>
            <button
              class="role-btn"
              [class.active]="selectedRole === 'adc'"
              (click)="selectRoleInModal('adc')"
            >
              üèπ ADC ({{ championsByRole.adc.length || 0 }})
            </button>
            <button
              class="role-btn"
              [class.active]="selectedRole === 'support'"
              (click)="selectRoleInModal('support')"
            >
              üíé Support ({{ championsByRole.support.length || 0 }})
            </button>
          </div>
        </div>

        <!-- Search -->
        <div class="modal-search-container">
          <div class="search-wrapper">
            <input
              id="modal-champion-search"
              type="text"
              [(ngModel)]="searchFilter"
              (ngModelChange)="onSearchChange($event)"
              placeholder="Buscar campe√£o pelo nome..."
              class="modal-champion-search"
              autocomplete="off"
            />
            <span class="search-icon">üîç</span>
          </div>
          <span class="search-results-count"
            >{{ getModalFilteredChampions().length }} campe√µes encontrados</span
          >
        </div>
      </div>

      <!-- Grid de Campe√µes -->
      <div class="modal-champions-grid">
        <div
          class="modal-champion-card"
          *ngFor="let champion of getModalFilteredChampions()"
          [class.selected]="selectedany?.id === champion.id"
          [class.banned]="isChampionBanned(champion)"
          [class.picked]="isChampionPicked(champion)"
          [class.disabled]="isChampionBanned(champion) || isChampionPicked(champion)"
          (click)="onanyCardClick(champion)"
          (keydown.enter)="onanyCardClick(champion)"
          (keydown.space)="onanyCardClick(champion)"
          [attr.tabindex]="isChampionBanned(champion) || isChampionPicked(champion) ? -1 : 0"
          [style.cursor]="isChampionBanned(champion) || isChampionPicked(champion) ? 'not-allowed' : 'pointer'"
          [style.opacity]="isChampionBanned(champion) || isChampionPicked(champion) ? '0.6' : '1'"
        >
          <img
            [src]="getChampionImageUrl(champion)"
            [alt]="champion.name"
            class="modal-champion-portrait"
            (error)="onImageError($event, champion)"
            loading="lazy"
          />
          <span class="modal-champion-label">{{ champion.name }}</span>
          <div class="banned-overlay" *ngIf="isChampionBanned(champion)">
            <span class="banned-text">BANIDO</span>
          </div>
          <div class="picked-overlay" *ngIf="isChampionPicked(champion)">
            <span class="picked-text">ESCOLHIDO</span>
          </div>
        </div>

        <!-- Estado vazio -->
        <div
          *ngIf="getModalFilteredChampions().length === 0"
          class="modal-no-champions"
        >
          <div class="no-champions-icon">üòî</div>
          <div class="no-champions-text">Nenhum campe√£o encontrado</div>
          <div class="no-champions-hint">Tente ajustar os filtros ou busca</div>
        </div>
      </div>
    </div>

    <!-- Footer do Modal com Confirma√ß√£o -->
    <div class="modal-footer">
      <div class="modal-selection-preview" *ngIf="selectedany">
        <div class="preview-content">
          <img
            [src]="getChampionImageUrl(selectedany)"
            [alt]="selectedany.name"
            class="preview-img"
          />
          <div class="preview-info">
            <span class="preview-name">{{ selectedany.name }}</span>
            <span class="preview-action"> {{ getCurrentActionText() }} </span>
          </div>
        </div>
      </div>

      <div class="modal-actions">
        <button
          class="btn btn-secondary cancel-btn"
          (click)="cancelModalSelection()"
        >
          ‚ùå Cancelar
        </button>
        <button
          class="btn btn-primary confirm-btn"
          [class.disabled]="!selectedany || isChampionBanned(selectedany) || isChampionPicked(selectedany)"
          [disabled]="!selectedany || isChampionBanned(selectedany) || isChampionPicked(selectedany)"
          (click)="confirmModalSelection()"
        >
          {{ getCurrentActionIcon() }} Confirmar {{ getCurrentActionText() }}
        </button>
      </div>
    </div>
  </div>
</div>
