<div
  class="final-confirmation-overlay"
  *ngIf="isVisible()"
  (click)="closeModal()"
  (keydown.escape)="closeModal()"
>
  <div
    class="final-confirmation-modal"
    (click)="$event.stopPropagation()"
    (keydown)="$event.stopPropagation()"
  >

    <!-- Header -->
    <div class="confirmation-header">
      <div class="header-left">
        <div class="confirmation-icon">üéØ</div>
        <div class="header-text">
          <h2>Confirmar Sele√ß√£o Final</h2>
          <p>
            - Verifique se todos os picks e bans est√£o corretos antes de
            continuar
          </p>
        </div>
      </div>
      <div class="header-right">
        <div class="progress-status-header">
          {{ getConfirmationCount().confirmed }}/{{ getConfirmationCount().total
          }} ({{ getConfirmationProgress() }}%)
        </div>
      </div>
    </div>

    <!-- Conte√∫do -->
    <div class="confirmation-content">
      <!-- Times lado a lado, igual √† tela principal -->
      <div class="teams-container">
        <!-- Time Azul -->
        <div class="team blue-team">
          <div class="team-header">
            <span class="team-name">üîµ Time Azul</span>
          </div>

          <!-- Bans do Time Azul -->
          <div class="team-bans">
            <div
              class="ban-slot"
              *ngFor="let ban of getTeamBans('blue'); let i = index"
            >
              <img [src]="ban.image" [alt]="ban.name" class="ban-img" />
              <span class="ban-name">{{ ban.name }}</span>
            </div>
            <!-- Slots vazios para completar 5 bans -->
            <div
              class="ban-slot empty-ban"
              *ngFor="let i of getEmptyBanSlots(getTeamBans('blue').length)"
            >
              <div class="ban-placeholder">?</div>
              <span class="ban-name">Ban</span>
            </div>
          </div>

          <div class="team-picks">
            <div
              class="team-slot"
              *ngFor="let slot of getTeamByLane('blue'); let i = index"
              [class.confirmed-player]="getPlayerConfirmationStatus(slot.player.summonerName) === 'confirmed'"
              [class.declined-player]="getPlayerConfirmationStatus(slot.player.summonerName) === 'declined'"
              [class.timeout-player]="getPlayerConfirmationStatus(slot.player.summonerName) === 'timeout'"
            >
              <!-- Status de confirma√ß√£o -->
              <div
                class="confirmation-status"
                [class]="getConfirmationStatusClass(slot.player)"
              >
                <span class="status-icon"
                  >{{ getConfirmationStatusIcon(slot.player) }}</span
                >
              </div>

              <div
                class="slot-content"
                [class.confirmed]="isPlayerConfirmed(slot.player)"
                [class.auto-confirmed]="isPlayerAutoConfirmed(slot.player)"
              >
                <div class="player-info">
                  <span class="player-name">
                    {{ slot.player.summonerName || slot.player.name || 'Jogador'
                    }}
                    <span
                      class="you-indicator"
                      *ngIf="isCurrentUser(slot.player)"
                      >(Voc√™)</span
                    >
                  </span>
                  <span class="player-lane">
                    {{ getPlayerLaneDisplayForPlayer(slot.player) }}
                  </span>
                </div>
                <div class="champion-info" *ngIf="slot.champion">
                  <img
                    [src]="slot.champion.image"
                    [alt]="slot.champion.name"
                    class="champion-img"
                  />
                  <span class="champion-name"> {{ slot.champion.name }} </span>
                </div>
                <div class="champion-placeholder" *ngIf="!slot.champion">?</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Time Vermelho -->
        <div class="team red-team">
          <div class="team-header">
            <span class="team-name">üî¥ Time Vermelho</span>
          </div>

          <!-- Bans do Time Vermelho -->
          <div class="team-bans">
            <div
              class="ban-slot"
              *ngFor="let ban of getTeamBans('red'); let i = index"
            >
              <img [src]="ban.image" [alt]="ban.name" class="ban-img" />
              <span class="ban-name">{{ ban.name }}</span>
            </div>
            <!-- Slots vazios para completar 5 bans -->
            <div
              class="ban-slot empty-ban"
              *ngFor="let i of getEmptyBanSlots(getTeamBans('red').length)"
            >
              <div class="ban-placeholder">?</div>
              <span class="ban-name">Ban</span>
            </div>
          </div>

          <div class="team-picks">
            <div
              class="team-slot"
              *ngFor="let slot of getTeamByLane('red'); let i = index"
              [class.confirmed-player]="getPlayerConfirmationStatus(slot.player.summonerName) === 'confirmed'"
              [class.declined-player]="getPlayerConfirmationStatus(slot.player.summonerName) === 'declined'"
              [class.timeout-player]="getPlayerConfirmationStatus(slot.player.summonerName) === 'timeout'"
            >
              <!-- Status de confirma√ß√£o -->
              <div
                class="confirmation-status"
                [class]="getConfirmationStatusClass(slot.player)"
              >
                <span class="status-icon"
                  >{{ getConfirmationStatusIcon(slot.player) }}</span
                >
              </div>

              <div
                class="slot-content"
                [class.confirmed]="isPlayerConfirmed(slot.player)"
                [class.auto-confirmed]="isPlayerAutoConfirmed(slot.player)"
              >
                <div class="player-info">
                  <span class="player-name">
                    {{ slot.player.summonerName || slot.player.name || 'Jogador'
                    }}
                    <span
                      class="you-indicator"
                      *ngIf="isCurrentUser(slot.player)"
                      >(Voc√™)</span
                    >
                  </span>
                  <span class="player-lane">
                    {{ getPlayerLaneDisplayForPlayer(slot.player) }}
                  </span>
                </div>
                <div class="champion-info" *ngIf="slot.champion">
                  <img
                    [src]="slot.champion.image"
                    [alt]="slot.champion.name"
                    class="champion-img"
                  />
                  <span class="champion-name">{{ slot.champion.name }}</span>
                </div>
                <div class="champion-placeholder" *ngIf="!slot.champion">?</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- A√ß√µes -->
    <div class="confirmation-actions">
      <!-- Mensagem de estado -->
      <p
        class="confirmation-message"
        *ngIf="confirmationMessage"
        [class.error]="confirmationMessage.includes('Erro')"
      >
        {{ confirmationMessage }}
      </p>

      <button
        class="btn btn-danger btn-lg"
        (click)="cancelFinalDraft()"
        [disabled]="isConfirming"
      >
        ‚ùå Cancelar Partida
      </button>
      <button
        class="btn btn-secondary btn-lg"
        (click)="startEditingCurrentPlayer()"
        [disabled]="isConfirming"
      >
        ‚úèÔ∏è Editar Minha Sele√ß√£o
      </button>
      <button
        class="btn btn-success btn-lg btn-confirm"
        (click)="confirmFinalDraft()"
        [disabled]="isConfirming"
        [class.loading]="isConfirming"
      >
        <span *ngIf="!isConfirming">‚úÖ Confirmar Draft Final</span>
        <span *ngIf="isConfirming">‚è≥ Confirmando...</span>
      </button>
    </div>
  </div>
</div>
