<div class="modal-overlay" (click)="cancel()">
  <div class="modal-container" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>üèÜ Confirmar Vencedor da Partida</h2>
      <button class="close-btn" (click)="cancel()">&times;</button>
    </div>

    <div class="modal-body">
      <p class="description">
        Selecione qual das √∫ltimas partidas personalizadas corresponde ao jogo que acabou de terminar:
      </p>

      <div class="matches-list">
        <div
          *ngFor="let option of matchOptions; let i = index"
          class="match-card"
          [class.selected]="selectedMatchIndex === i"
          [class.has-winner]="option.winningTeam"
          (click)="selectMatch(i)">

          <div class="match-header">
            <div class="match-info">
              <span class="match-number">Partida #{{i + 1}}</span>
              <span class="match-time">{{ option.formattedDate }}</span>
              <span class="match-duration">‚è±Ô∏è {{ option.formattedDuration }}</span>

              <!-- Vote Counter -->
              <span class="vote-badge" *ngIf="option.voteCount && option.voteCount > 0">
                üó≥Ô∏è {{ option.voteCount }}/10 votos
              </span>

              <!-- You Voted Badge -->
              <span class="voted-badge" *ngIf="myVotedGameId === option.match.gameId">
                ‚úì Voc√™ votou aqui
              </span>
            </div>

            <div class="winner-badge" *ngIf="option.winningTeam">
              <span [class.blue-winner]="option.winningTeam === 'blue'"
                    [class.red-winner]="option.winningTeam === 'red'">
                Vencedor: {{ option.winningTeam === 'blue' ? 'Time Azul' : 'Time Vermelho' }}
              </span>
            </div>
          </div>

          <!-- Vote Progress Bar -->
          <div class="vote-progress-container" *ngIf="option.voteCount && option.voteCount > 0">
            <div class="vote-progress-bar" [style.width.%]="(option.voteCount / 10) * 100">
              <span class="progress-text" *ngIf="option.voteCount >= 5">
                {{ option.voteCount >= 5 ? 'Vinculando...' : '' }}
              </span>
            </div>
          </div>

          <div class="match-teams">
            <!-- Blue Team -->
            <div class="team blue-team">
              <div class="team-header">
                <span class="team-icon">üîµ</span>
                <span class="team-name">Time Azul</span>
                <span class="team-badge" *ngIf="option.winningTeam === 'blue'">üëë</span>
              </div>
              <div class="players-list-detailed">
                <div
                  *ngFor="let player of getPlayersByTeam(option.match, 100)"
                  class="player-detailed-item"
                  [class.our-player]="isPlayerInOurMatch(player, 'blue')">

                  <!-- Champion Icon & Name -->
                  <div class="player-champion-section">
                    <div class="champion-icon-wrapper">
                      <img
                        [src]="getChampionIconUrl(player.championId)"
                        [alt]="getChampionName(player.championId)"
                        class="champion-icon"
                        onerror="this.src='assets/images/champion-placeholder.svg'">
                      <span class="champion-level">{{ player.champLevel }}</span>
                    </div>
                    <div class="champion-info">
                      <span class="champion-name">{{ getChampionName(player.championId) }}</span>
                    </div>
                  </div>

                  <!-- Summoner Name -->
                  <div class="player-name-section">
                    <span class="player-name">{{ player.summonerName || player.riotIdGameName }}</span>
                    <span class="our-player-badge" *ngIf="isPlayerInOurMatch(player, 'blue')">‚úì Voc√™</span>
                  </div>

                  <!-- KDA -->
                  <div class="player-kda-section">
                    <span class="kda-label">KDA:</span>
                    <span class="kda-value">
                      <span class="kills">{{ player.kills }}</span> /
                      <span class="deaths">{{ player.deaths }}</span> /
                      <span class="assists">{{ player.assists }}</span>
                    </span>
                    <span class="kda-ratio" [class.perfect-kda]="player.deaths === 0">
                      {{ getKDAFormattedRatio(player) }}
                    </span>
                  </div>

                  <!-- Items -->
                  <div class="player-items-section">
                    <div class="items-grid">
                      <div class="item-slot" *ngFor="let itemId of getPlayerItems(player)">
                        <img
                          *ngIf="itemId > 0"
                          [src]="getItemIconUrl(itemId)"
                          [alt]="'Item ' + itemId"
                          class="item-icon"
                          onerror="this.src='assets/images/item-placeholder.svg'">
                        <div *ngIf="itemId === 0" class="item-empty"></div>
                      </div>
                    </div>
                  </div>

                  <!-- Stats Summary -->
                  <div class="player-stats-section">
                    <span class="stat-item" title="Dano aos Campe√µes">
                      <span class="stat-icon">‚öîÔ∏è</span>
                      {{ formatNumber(player.totalDamageDealtToChampions) }}
                    </span>
                    <span class="stat-item" title="Gold">
                      <span class="stat-icon">üí∞</span>
                      {{ formatNumber(player.goldEarned) }}
                    </span>
                    <span class="stat-item" title="CS (Creep Score)">
                      <span class="stat-icon">üó°Ô∏è</span>
                      {{ player.totalMinionsKilled + player.neutralMinionsKilled }}
                    </span>
                  </div>
                </div>
              </div>
            </div>

            <!-- VS Separator -->
            <div class="vs-separator">VS</div>

            <!-- Red Team -->
            <div class="team red-team">
              <div class="team-header">
                <span class="team-icon">üî¥</span>
                <span class="team-name">Time Vermelho</span>
                <span class="team-badge" *ngIf="option.winningTeam === 'red'">üëë</span>
              </div>
              <div class="players-list-detailed">
                <div
                  *ngFor="let player of getPlayersByTeam(option.match, 200)"
                  class="player-detailed-item"
                  [class.our-player]="isPlayerInOurMatch(player, 'red')">

                  <!-- Champion Icon & Name -->
                  <div class="player-champion-section">
                    <div class="champion-icon-wrapper">
                      <img
                        [src]="getChampionIconUrl(player.championId)"
                        [alt]="getChampionName(player.championId)"
                        class="champion-icon"
                        onerror="this.src='assets/images/champion-placeholder.svg'">
                      <span class="champion-level">{{ player.champLevel }}</span>
                    </div>
                    <div class="champion-info">
                      <span class="champion-name">{{ getChampionName(player.championId) }}</span>
                    </div>
                  </div>

                  <!-- Summoner Name -->
                  <div class="player-name-section">
                    <span class="player-name">{{ player.summonerName || player.riotIdGameName }}</span>
                    <span class="our-player-badge" *ngIf="isPlayerInOurMatch(player, 'red')">‚úì Voc√™</span>
                  </div>

                  <!-- KDA -->
                  <div class="player-kda-section">
                    <span class="kda-label">KDA:</span>
                    <span class="kda-value">
                      <span class="kills">{{ player.kills }}</span> /
                      <span class="deaths">{{ player.deaths }}</span> /
                      <span class="assists">{{ player.assists }}</span>
                    </span>
                    <span class="kda-ratio" [class.perfect-kda]="player.deaths === 0">
                      {{ getKDAFormattedRatio(player) }}
                    </span>
                  </div>

                  <!-- Items -->
                  <div class="player-items-section">
                    <div class="items-grid">
                      <div class="item-slot" *ngFor="let itemId of getPlayerItems(player)">
                        <img
                          *ngIf="itemId > 0"
                          [src]="getItemIconUrl(itemId)"
                          [alt]="'Item ' + itemId"
                          class="item-icon"
                          onerror="this.src='assets/images/item-placeholder.svg'">
                        <div *ngIf="itemId === 0" class="item-empty"></div>
                      </div>
                    </div>
                  </div>

                  <!-- Stats Summary -->
                  <div class="player-stats-section">
                    <span class="stat-item" title="Dano aos Campe√µes">
                      <span class="stat-icon">‚öîÔ∏è</span>
                      {{ formatNumber(player.totalDamageDealtToChampions) }}
                    </span>
                    <span class="stat-item" title="Gold">
                      <span class="stat-icon">üí∞</span>
                      {{ formatNumber(player.goldEarned) }}
                    </span>
                    <span class="stat-item" title="CS (Creep Score)">
                      <span class="stat-icon">üó°Ô∏è</span>
                      {{ player.totalMinionsKilled + player.neutralMinionsKilled }}
                    </span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="match-footer">
            <span class="match-count">
              Jogadores da nossa partida:
              <strong>{{ option.ourPlayers.blue.length + option.ourPlayers.red.length }}/10</strong>
            </span>
          </div>
        </div>

        <div class="no-matches" *ngIf="matchOptions.length === 0">
          <p>‚ùå Nenhuma partida personalizada encontrada no hist√≥rico.</p>
          <p>Certifique-se de que a partida foi conclu√≠da no League of Legends.</p>
        </div>
      </div>
    </div>

    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="cancel()">
        Cancelar
      </button>
      <button
        class="btn btn-primary"
        (click)="confirmSelection()"
        [disabled]="selectedMatchIndex === null">
        Confirmar Vencedor
      </button>
    </div>
  </div>
</div>
