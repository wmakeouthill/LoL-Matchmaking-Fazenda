databaseChangeLog:
  - changeSet:
      id: 001-baseline
      author: refactor
      changes:
        - createTable:
            tableName: players
            columns:
              - column: { name: id, type: BIGINT AUTO_INCREMENT, constraints: { primaryKey: true }}
              - column: { name: summoner_name, type: VARCHAR(255), constraints: { nullable: false, unique: true }}
              - column: { name: summoner_id, type: VARCHAR(255) }
              - column: { name: puuid, type: VARCHAR(255) }
              - column: { name: region, type: VARCHAR(10), constraints: { nullable: false }}
              - column: { name: current_mmr, type: INT, defaultValueNumeric: 1000 }
              - column: { name: peak_mmr, type: INT, defaultValueNumeric: 1000 }
              - column: { name: games_played, type: INT, defaultValueNumeric: 0 }
              - column: { name: wins, type: INT, defaultValueNumeric: 0 }
              - column: { name: losses, type: INT, defaultValueNumeric: 0 }
              - column: { name: win_streak, type: INT, defaultValueNumeric: 0 }
              - column: { name: created_at, type: TIMESTAMP, defaultValueComputed: CURRENT_TIMESTAMP }
              - column: { name: updated_at, type: TIMESTAMP, defaultValueComputed: CURRENT_TIMESTAMP }
              - column: { name: custom_mmr, type: INT, defaultValueNumeric: 1000 }
              - column: { name: custom_peak_mmr, type: INT, defaultValueNumeric: 1000 }
              - column: { name: custom_games_played, type: INT, defaultValueNumeric: 0 }
              - column: { name: custom_wins, type: INT, defaultValueNumeric: 0 }
              - column: { name: custom_losses, type: INT, defaultValueNumeric: 0 }
              - column: { name: custom_win_streak, type: INT, defaultValueNumeric: 0 }
              - column: { name: custom_lp, type: INT, defaultValueNumeric: 0 }
        - addUniqueConstraint: { tableName: players, columnNames: puuid, constraintName: uq_players_puuid }
        - createTable:
            tableName: custom_matches
            columns:
              - column: { name: id, type: BIGINT AUTO_INCREMENT, constraints: { primaryKey: true }}
              - column: { name: title, type: VARCHAR(255) }
              - column: { name: description, type: TEXT }
              - column: { name: team1_players, type: TEXT, constraints: { nullable: false }}
              - column: { name: team2_players, type: TEXT, constraints: { nullable: false }}
              - column: { name: winner_team, type: INT }
              - column: { name: status, type: VARCHAR(50), defaultValue: pending }
              - column: { name: created_by, type: VARCHAR(255), constraints: { nullable: true }}
              - column: { name: created_at, type: TIMESTAMP, defaultValueComputed: CURRENT_TIMESTAMP }
              - column: { name: completed_at, type: TIMESTAMP }
              - column: { name: game_mode, type: VARCHAR(20), defaultValue: 5v5 }
              - column: { name: duration, type: INT }
              - column: { name: lp_changes, type: TEXT }
              - column: { name: average_mmr_team1, type: INT }
              - column: { name: average_mmr_team2, type: INT }
              - column: { name: participants_data, type: TEXT }
              - column: { name: riot_game_id, type: VARCHAR(255) }
              - column: { name: detected_by_lcu, type: TINYINT, defaultValueNumeric: 0 }
              - column: { name: notes, type: TEXT }
              - column: { name: custom_lp, type: INT, defaultValueNumeric: 0 }
              - column: { name: updated_at, type: TIMESTAMP }
              - column: { name: pick_ban_data, type: TEXT }
              - column: { name: linked_results, type: TEXT }
              - column: { name: actual_winner, type: INT }
              - column: { name: actual_duration, type: INT }
              - column: { name: riot_id, type: VARCHAR(255) }
              - column: { name: mmr_changes, type: TEXT }
              - column: { name: match_leader, type: VARCHAR(255) }
              - column: { name: owner_backend_id, type: VARCHAR(100) }
              - column: { name: owner_heartbeat, type: BIGINT }
        - createIndex:
            tableName: custom_matches
            indexName: idx_owner_backend_id
            columns:
              - column: { name: owner_backend_id }
        - createIndex:
            tableName: custom_matches
            indexName: idx_owner_heartbeat
            columns:
              - column: { name: owner_heartbeat }
        - createIndex:
            tableName: custom_matches
            indexName: idx_custom_status
            columns:
              - column: { name: status }
        - createTable:
            tableName: event_inbox
            columns:
              - column: { name: id, type: BIGINT AUTO_INCREMENT, constraints: { primaryKey: true }}
              - column: { name: event_id, type: VARCHAR(191), constraints: { nullable: false }}
              - column: { name: event_type, type: VARCHAR(50), constraints: { nullable: false }}
              - column: { name: match_id, type: BIGINT }
              - column: { name: backend_id, type: VARCHAR(100), constraints: { nullable: false }}
              - column: { name: payload, type: TEXT }
              - column: { name: timestamp, type: BIGINT, constraints: { nullable: false }}
              - column: { name: received_at, type: TIMESTAMP, defaultValueComputed: CURRENT_TIMESTAMP }
        - addUniqueConstraint: { tableName: event_inbox, columnNames: event_id, constraintName: uq_event_inbox_event_id }
        - createIndex:
            tableName: event_inbox
            indexName: idx_event_type
            columns:
              - column: { name: event_type }
        - createIndex:
            tableName: event_inbox
            indexName: idx_match_id
            columns:
              - column: { name: match_id }
        - createIndex:
            tableName: event_inbox
            indexName: idx_backend
            columns:
              - column: { name: backend_id }
