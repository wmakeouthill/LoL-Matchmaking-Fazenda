server:
  port: 8080

spring:
  config:
    import: optional:classpath:/application-secrets.properties
  application:
    name: lol-matchmaking-backend

  datasource:
    # URL prioriza DATABASE_URL completa; fallback monta partir de variáveis MYSQL_* e DB_*
    url: ${DATABASE_URL:jdbc:mysql://${MYSQL_HOST:${DB_HOST:localhost}}:${MYSQL_PORT:${DB_PORT:3306}}/${MYSQL_DATABASE:${DB_NAME:lolmatchmaking}}?useSSL=false&serverTimezone=UTC&allowPublicKeyRetrieval=true&useUnicode=true&characterEncoding=utf8&autoReconnect=true&connectTimeout=30000&socketTimeout=30000&zeroDateTimeBehavior=convertToNull}
    driver-class-name: com.mysql.cj.jdbc.Driver
    username: ${MYSQL_USER:${DB_USER:root}}
    password: ${MYSQL_PASSWORD:${DB_PASSWORD:password}}
    hikari:
      maximum-pool-size: ${DB_POOL_MAX:10}
      minimum-idle: ${DB_POOL_MIN:2}
      connection-timeout: ${DB_CONNECTION_TIMEOUT:30000}
      idle-timeout: ${DB_IDLE_TIMEOUT:600000}
      max-lifetime: ${DB_MAX_LIFETIME:1800000}
      validation-timeout: 5000

  jpa:
    database-platform: org.hibernate.dialect.MySQLDialect
    hibernate:
      ddl-auto: none # Em produção evitar update automático; usar migrações (Liquibase)
    show-sql: false
    open-in-view: false
    properties:
      hibernate:
        # dialect removido (Hibernate 6 autodetecta). Se desejar fixar, usar org.hibernate.dialect.MySQLDialect
  liquibase:
    enabled: true
    change-log: classpath:db/changelog/db.changelog-master.yaml

  h2:
    console:
      enabled: false

  # WebSocket allowed origins handled in WebSocketConfig (CORS configured in code)

  task:
    execution:
      pool:
        core-size: 20
        max-size: 50
        queue-capacity: 500
      shutdown:
        await-termination: true
        await-termination-period: 30s
    scheduling:
      pool:
        size: 20

logging:
  pattern:
    console: "%d{HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n"

management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics
  endpoint:
    health:
      show-details: always
# Liquibase baseline: changeSets criam tabelas apenas se não existirem.
# Rotacionar credenciais expostas anteriormente imediatamente.
